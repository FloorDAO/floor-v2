# StrategyFactory
[Git Source](https://github.com/FloorDAO/floor-v2/blob/fd4de86a192de96d73fe2e56a84ec542b57b1c69/src/contracts/strategies/StrategyFactory.sol)

**Inherits:**
[AuthorityControl](/src/contracts/authorities/AuthorityControl.sol/contract.AuthorityControl.md), [IStrategyFactory](/src/interfaces/strategies/StrategyFactory.sol/contract.IStrategyFactory.md)

Allows for vaults to be created, pairing them with an approved collection. The vault
creation script needs to be as highly optimised as possible to ensure that the gas
costs are kept down.
This factory will keep an index of created vaults and secondary information to ensure
that external applications can display and maintain a list of available vaults.


## State Variables
### _strategies
Maintains an array of all vaults created


```solidity
address[] private _strategies;
```


### treasury
Store our Treasury address


```solidity
address public treasury;
```


### collectionRegistry
Contract mappings to our internal registries


```solidity
ICollectionRegistry public immutable collectionRegistry;
```


### strategyIds
Mappings to aide is discoverability


```solidity
mapping(uint => address) private strategyIds;
```


### collectionStrategies

```solidity
mapping(address => address[]) public collectionStrategies;
```


## Functions
### constructor

Store our registries, mapped to their interfaces.


```solidity
constructor(address _authority, address _collectionRegistry) AuthorityControl(_authority);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_authority`|`address`|{AuthorityRegistry} contract address|
|`_collectionRegistry`|`address`|Address of our {CollectionRegistry}|


### strategies

Provides a list of all strategies created.


```solidity
function strategies() external view returns (address[] memory);
```
**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`address[]`|Array of all strategies created by the {StrategyFactory}|


### strategy

Provides a strategy against the provided `strategyId` (index). If the index does not exist,
then address(0) will be returned.


```solidity
function strategy(uint _strategyId) external view returns (address);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_strategyId`|`uint256`|ID of the strategy to retrieve|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`address`|Address of the strategy|


### deployStrategy

Creates a vault with an approved collection.

*The vault is not created using Clones as there are complications when allocated
roles and permissions.*


```solidity
function deployStrategy(bytes32 _name, address _strategy, bytes calldata _strategyInitData, address _collection)
    external
    onlyRole(VAULT_MANAGER)
    returns (uint strategyId_, address strategyAddr_);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_name`|`bytes32`|Human-readable name of the vault|
|`_strategy`|`address`|The strategy implemented by the vault|
|`_strategyInitData`|`bytes`|Bytes data required by the {Strategy} for initialization|
|`_collection`|`address`|The address of the collection attached to the vault|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`strategyId_`|`uint256`|ID of the newly created vault|
|`strategyAddr_`|`address`|Address of the newly created vault|


### pause

Allows individual vaults to be paused, meaning that assets can no longer be deposited,
although staked assets can always be withdrawn.

*Events are fired within the vault to allow listeners to update.*


```solidity
function pause(uint _strategyId, bool _paused) public onlyRole(VAULT_MANAGER);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_strategyId`|`uint256`|Vault ID to be updated|
|`_paused`|`bool`|If the vault should be paused or unpaused|


### snapshot

Reads the yield generated by a strategy since the last time that this function was called.


```solidity
function snapshot(uint _strategyId) external onlyRole(VAULT_MANAGER) returns (address[] memory tokens, uint[] memory amounts);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_strategyId`|`uint256`|Vault ID to be updated|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`tokens`|`address[]`|Tokens that have been generated as yield|
|`amounts`|`uint256[]`|The amount of yield generated for the corresponding token|


### harvest

Harvest available reward yield from the strategy. This won't affect the amount
depositted into the contract and should only harvest rewards directly into the
{Treasury}.


```solidity
function harvest(uint _strategyId) external onlyRole(VAULT_MANAGER);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_strategyId`|`uint256`|Vault ID to be updated|


### withdraw

Makes a call to a strategy withdraw function by passing the strategy ID and
`abi.encodeWithSelector` to build the bytes `_data` parameter. This will then
pass the data on to the strategy function and inject the treasury recipient
address within the call as the first function parameter.

*It is required for the transaction to return a successful call, otherwise
the transaction will be reverted. The error response will be standardised so
debugging will require a trace, rather than just the end message.*


```solidity
function withdraw(uint _strategyId, bytes calldata _data) external onlyRole(VAULT_MANAGER);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_strategyId`|`uint256`|Vault ID to be updated|
|`_data`|`bytes`|Strategy withdraw function call, using `encodeWithSelector`|


### setTreasury

Allows the {Treasury} contract address to be updated. All withdrawals will
be requested to be sent to this address when the `withdraw` is called.

*This address is dynamically injected into the subsequent strategy
withdraw call.*


```solidity
function setTreasury(address _treasury) public onlyRole(TREASURY_MANAGER);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_treasury`|`address`|The new {Treasury} contract address|


